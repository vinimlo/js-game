<!DOCTYPE html>
<html lang="pt-br" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>|Pong Game|</title>
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <script type="text/javascript">

      //canvas
      var canvas = document.getElementById("canvas");
      var graphic = canvas.getContext("2d");
      canvas.width = 800;
      canvas.height = 600;

      var g = graphic;
      //end canvas

      //global
      var keysDown = {};
      //end global

      function logic(){
        ball.logic();
        player.logic();
      }

      function draw(){
        g.beginPath();

        //background
        g.fillStyle = "#000";
        g.fillRect(0, 0, canvas.width, canvas.height);
        //end background

        ball.draw();
        player.draw();

        g.closePath();
      }

      addEventListener(
        "keydown",
        function(e) {
          keysDown[e.keyCode] = true;
        },
        false
      );

      addEventListener(
        "keyup",
        function(e) {
          delete keysDown[e.keyCode];
        },
        false
      );

      var game = {
        fps: 60,
        run: function() {
          logic();
          draw();
        },
        start: function() {
          var interval = setInterval(game.run, 1000/game.fps);
        },
        stop: function() {
          alert("GAME OVER");
          document.location.reload();
          clearInterval(interval);
        }
      }

      var ball = {
        radius: 12,
        x: canvas.width/2,
        y: canvas.height/2,
        dx: 2,
        dy: -2,
        logic: function() {
          ball.x += ball.dx;
          ball.y += ball.dy;

          if(ball.y + ball.dy < ball.radius) ball.dy *= -1;
          else if(ball.y + ball.dy >= canvas.height - ball.radius - player.height) {
            if(ball.x > player.x && ball.x < player.x + player.width) {
              ball.dy *= -1;
            } else {
              game.stop();
            }
          }
          if(ball.y + ball.dy >= canvas.height - ball.radius) ball.dy *= -1;

          if(ball.x + ball.dx <= 0 || ball.x + ball.dx >= canvas.width - ball.radius) ball.dx *= -1;
        },
        draw: function() {
          g.fillStyle = "#0095DD";
          g.arc( ball.x, ball.y, ball.radius, 0, Math.PI*2);
          g.fill();
        }
      }

      var player = {
        width: 150,
        height: 20,
        x: canvas.width/2 - 75,
        y: canvas.height - 20,
        speed: 7,
        dx: 0,
        movement: function(deltaX) {
          if (player.x + deltaX <= 0)  {
            player.x = 0;
          }else if (player.x + player.width + deltaX >= canvas.width) {
            player.x = canvas.width - player.width;
          }else {
            player.x += deltaX * player.speed;
          }
        },
        logic: function() {
          if(37 in keysDown) player.movement(-1);
          if(39 in keysDown) player.movement(1);
        },
        draw: function() {
          g.fillStyle = "#0095DD";
          g.fillRect(player.x, player.y, player.width, player.height);
        }
      }

      function pong() {

      }

      //jogo
      game.start();
      //end jogo

    </script>
  </body>
</html>
